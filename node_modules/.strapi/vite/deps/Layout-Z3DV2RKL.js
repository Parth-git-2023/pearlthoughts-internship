import {
  require_sortBy
} from "./chunk-4Y4KEVXY.js";
import "./chunk-KJ5UJ4XF.js";
import {
  selectAdminPermissions
} from "./chunk-LXFYASOI.js";
import "./chunk-BLK5K7NI.js";
import {
  SETTINGS_LINKS_CE,
  SubNav
} from "./chunk-2ZQUEACL.js";
import "./chunk-4J4JH4DL.js";
import {
  useEnterprise
} from "./chunk-HXZ2GHFZ.js";
import {
  Layouts
} from "./chunk-O6JJIRK6.js";
import {
  useAppInfo,
  useTracking
} from "./chunk-DHQERSO6.js";
import "./chunk-GLPT7RON.js";
import {
  Page
} from "./chunk-OUTHPJ5W.js";
import {
  useAuth,
  useStrapiApp
} from "./chunk-YQN4TQZU.js";
import "./chunk-ITUTZMO4.js";
import "./chunk-S4GSJQUH.js";
import "./chunk-3CYOA7RQ.js";
import "./chunk-3Y3HZKRY.js";
import "./chunk-PR5W4YOM.js";
import {
  Navigate,
  Outlet,
  useLocation,
  useMatch
} from "./chunk-QOSJGLB6.js";
import "./chunk-UCDGERJK.js";
import "./chunk-2T3F2FEA.js";
import "./chunk-FBKW3ZX5.js";
import "./chunk-6XMPWYL4.js";
import "./chunk-2VOUQL7N.js";
import "./chunk-XNLL4XTY.js";
import "./chunk-VJHHRLHY.js";
import {
  useSelector
} from "./chunk-HWWDZF4D.js";
import "./chunk-Z7WXACEM.js";
import "./chunk-PZKJYQOP.js";
import "./chunk-KTCYCI5X.js";
import "./chunk-4S6CO3NF.js";
import "./chunk-WZMMABOO.js";
import "./chunk-KU6R7J3L.js";
import "./chunk-ALOZZQWE.js";
import "./chunk-3XH2Q2B6.js";
import "./chunk-SM5ZDAVK.js";
import "./chunk-AAOWBC4P.js";
import "./chunk-AVUVASSG.js";
import "./chunk-DEZRKVMG.js";
import "./chunk-LDTLLP4K.js";
import "./chunk-CFOYKXNH.js";
import "./chunk-DWNGFC4T.js";
import "./chunk-PQYVQDZP.js";
import "./chunk-ZGAXZ2TY.js";
import "./chunk-6EUDYBNR.js";
import "./chunk-3KMG3VFU.js";
import "./chunk-UTVXCYRG.js";
import {
  Badge,
  Divider
} from "./chunk-3AUSDG4O.js";
import {
  ForwardRef$2x
} from "./chunk-F5I3ZVMF.js";
import {
  dt
} from "./chunk-FJZ2NJT6.js";
import "./chunk-VH7UJDNP.js";
import "./chunk-HG4QJCZT.js";
import "./chunk-I7DIJEXN.js";
import {
  useIntl
} from "./chunk-2BDXRWHF.js";
import "./chunk-SBRVGDJ6.js";
import "./chunk-YUZK7WZ2.js";
import "./chunk-NSR7OH4Q.js";
import "./chunk-ZCDXR5JO.js";
import "./chunk-47RN6QNY.js";
import "./chunk-URNLJJFR.js";
import "./chunk-JHXWLAQ5.js";
import "./chunk-PWXBRFBA.js";
import "./chunk-MZAWSZWW.js";
import "./chunk-QIQU42WJ.js";
import "./chunk-XVBZSUZI.js";
import "./chunk-2NWCSGSS.js";
import {
  require_jsx_runtime
} from "./chunk-GAPF2DTI.js";
import {
  require_react
} from "./chunk-2ZN62OJX.js";
import "./chunk-IV5CMKTD.js";
import "./chunk-ENGB2K3X.js";
import "./chunk-ISIKDMAB.js";
import "./chunk-X5DDYWPV.js";
import "./chunk-TUHVKLNT.js";
import "./chunk-3POB64WN.js";
import "./chunk-63YMLYWU.js";
import "./chunk-YIY4KI6G.js";
import "./chunk-7CLWPW6Q.js";
import "./chunk-IVGYXB4P.js";
import "./chunk-H3WCXLKE.js";
import "./chunk-NDGNZ36Q.js";
import "./chunk-MNGCFISN.js";
import {
  __toESM
} from "./chunk-X6GFWOGJ.js";

// ../packages/core/admin/admin/src/hooks/useSettingsMenu.ts
var React = __toESM(require_react());
var import_sortBy = __toESM(require_sortBy());
var formatLinks = (menu) => menu.map((menuSection) => {
  const formattedLinks = menuSection.links.map((link) => ({
    ...link,
    isDisplayed: false
  }));
  return { ...menuSection, links: formattedLinks };
});
var useSettingsMenu = () => {
  const [{ isLoading, menu }, setData] = React.useState({
    isLoading: true,
    menu: []
  });
  const checkUserHasPermission = useAuth(
    "useSettingsMenu",
    (state) => state.checkUserHasPermissions
  );
  const shouldUpdateStrapi = useAppInfo("useSettingsMenu", (state) => state.shouldUpdateStrapi);
  const settings = useStrapiApp("useSettingsMenu", (state) => state.settings);
  const permissions = useSelector(selectAdminPermissions);
  const ceLinks = React.useMemo(() => SETTINGS_LINKS_CE(), []);
  const { admin: adminLinks, global: globalLinks } = useEnterprise(
    ceLinks,
    async () => (await import("./constants-NPG5FWT5.js")).SETTINGS_LINKS_EE(),
    {
      combine(ceLinks2, eeLinks) {
        return {
          admin: [...eeLinks.admin, ...ceLinks2.admin],
          global: [...ceLinks2.global, ...eeLinks.global]
        };
      },
      defaultValue: {
        admin: [],
        global: []
      }
    }
  );
  const addPermissions = React.useCallback(
    (link) => {
      var _a, _b;
      if (!link.id) {
        throw new Error("The settings menu item must have an id attribute.");
      }
      return {
        ...link,
        permissions: ((_b = (_a = permissions.settings) == null ? void 0 : _a[link.id]) == null ? void 0 : _b.main) ?? []
      };
    },
    [permissions.settings]
  );
  React.useEffect(() => {
    const getData = async () => {
      const buildMenuPermissions = (sections2) => Promise.all(
        sections2.reduce((acc, section, sectionIndex) => {
          const linksWithPermissions = section.links.map(async (link, linkIndex) => ({
            hasPermission: (await checkUserHasPermission(link.permissions)).length > 0,
            sectionIndex,
            linkIndex
          }));
          return [...acc, ...linksWithPermissions];
        }, [])
      );
      const menuPermissions = await buildMenuPermissions(sections);
      setData((prev) => {
        return {
          ...prev,
          isLoading: false,
          menu: sections.map((section, sectionIndex) => ({
            ...section,
            links: section.links.map((link, linkIndex) => {
              const permission = menuPermissions.find(
                (permission2) => permission2.sectionIndex === sectionIndex && permission2.linkIndex === linkIndex
              );
              return {
                ...link,
                isDisplayed: Boolean(permission == null ? void 0 : permission.hasPermission)
              };
            })
          }))
        };
      });
    };
    const { global, ...otherSections } = settings;
    const sections = formatLinks([
      {
        ...global,
        links: (0, import_sortBy.default)([...global.links, ...globalLinks.map(addPermissions)], (link) => link.id).map(
          (link) => ({
            ...link,
            hasNotification: link.id === "000-application-infos" && shouldUpdateStrapi
          })
        )
      },
      {
        id: "permissions",
        intlLabel: { id: "Settings.permissions", defaultMessage: "Administration Panel" },
        links: adminLinks.map(addPermissions)
      },
      ...Object.values(otherSections)
    ]);
    getData();
  }, [
    adminLinks,
    globalLinks,
    settings,
    shouldUpdateStrapi,
    addPermissions,
    checkUserHasPermission
  ]);
  return {
    isLoading,
    menu: menu.map((menuItem) => ({
      ...menuItem,
      links: menuItem.links.filter((link) => link.isDisplayed)
    }))
  };
};

// ../packages/core/admin/admin/src/pages/Settings/components/SettingsNav.tsx
var import_jsx_runtime = __toESM(require_jsx_runtime());
var StyledBadge = dt(Badge)`
  border-radius: 50%;
  padding: ${({ theme }) => theme.spaces[2]};
  height: 2rem;
`;
var SettingsNav = ({ menu }) => {
  const { formatMessage } = useIntl();
  const { trackUsage } = useTracking();
  const { pathname } = useLocation();
  const filteredMenu = menu.filter(
    (section) => !section.links.every((link) => link.isDisplayed === false)
  );
  const sections = filteredMenu.map((section) => {
    return {
      ...section,
      title: section.intlLabel,
      links: section.links.map((link) => {
        return {
          ...link,
          title: link.intlLabel,
          name: link.id
        };
      })
    };
  });
  const label = formatMessage({
    id: "global.settings",
    defaultMessage: "Settings"
  });
  const handleClickOnLink = (destination) => () => {
    trackUsage("willNavigate", { from: pathname, to: destination });
  };
  return (0, import_jsx_runtime.jsxs)(SubNav.Main, { "aria-label": label, children: [
    (0, import_jsx_runtime.jsx)(SubNav.Header, { label }),
    (0, import_jsx_runtime.jsx)(Divider, { background: "neutral150", marginBottom: 5 }),
    (0, import_jsx_runtime.jsx)(SubNav.Sections, { children: sections.map((section) => (0, import_jsx_runtime.jsx)(SubNav.Section, { label: formatMessage(section.intlLabel), children: section.links.map((link) => {
      return (0, import_jsx_runtime.jsx)(
        SubNav.Link,
        {
          to: link.to,
          onClick: handleClickOnLink(link.to),
          label: formatMessage(link.intlLabel),
          endAction: (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
            (link == null ? void 0 : link.licenseOnly) && (0, import_jsx_runtime.jsx)(ForwardRef$2x, { fill: "primary600", width: "1.5rem", height: "1.5rem" }),
            (link == null ? void 0 : link.hasNotification) && (0, import_jsx_runtime.jsx)(
              StyledBadge,
              {
                "aria-label": "Notification",
                backgroundColor: "primary600",
                textColor: "neutral0",
                children: "1"
              }
            )
          ] })
        },
        link.id
      );
    }) }, section.id)) })
  ] });
};

// ../packages/core/admin/admin/src/pages/Settings/Layout.tsx
var import_jsx_runtime2 = __toESM(require_jsx_runtime());
var Layout = () => {
  const match = useMatch("/settings/:settingId/*");
  const { formatMessage } = useIntl();
  const { isLoading, menu } = useSettingsMenu();
  if (isLoading) {
    return (0, import_jsx_runtime2.jsx)(Page.Loading, {});
  }
  if (!(match == null ? void 0 : match.params.settingId)) {
    return (0, import_jsx_runtime2.jsx)(Navigate, { to: "application-infos" });
  }
  return (0, import_jsx_runtime2.jsxs)(Layouts.Root, { sideNav: (0, import_jsx_runtime2.jsx)(SettingsNav, { menu }), children: [
    (0, import_jsx_runtime2.jsx)(Page.Title, { children: formatMessage({
      id: "global.settings",
      defaultMessage: "Settings"
    }) }),
    (0, import_jsx_runtime2.jsx)(Outlet, {})
  ] });
};
export {
  Layout
};
//# sourceMappingURL=Layout-Z3DV2RKL.js.map
